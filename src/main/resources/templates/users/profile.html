<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BattleBuddies</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;amp;lang=en"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link href="https://fonts.gstatic.com" crossorigin="anonymous" rel="preconnect"/>
    <link href="https://ajax.googleapis.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
    <style>
        nav {
            height: 99px !important;
            line-height: 99px !important;
        }

        html, body {
            height: 100%;


            /* Image is centered vertically and horizontally at all times */
            background-position: center center;

            /* Image doesn't repeat */
            background-repeat: no-repeat;

            /* Makes the image fixed in the viewport so that it doesn't move when
               the content height is greater than the image height */
            background-attachment: fixed;

            /* This is what makes the background image rescale based on its container's size */
            background-size: cover;

            /* Pick a solid background color that will be displayed while the background image is loading */
            background-color: #464646;

            /* SHORTHAND CSS NOTATION
             * background: url(background-photo.jpg) center center cover no-repeat fixed;
             */
        }

        .hex {
            clip-path: polygon(50% 0, 100% 25%, 100% 75%, 50% 100%, 0 75%, 0 25%) !important;
            background-size: cover !important;
            margin: 10px auto !important;
            height: 200px !important;
            width: 200px !important;

        }

        .hexagon {
            position: relative;
            width: 500px;
            height: 288.68px;
            background: #CD5C5C;
            margin: 144px auto;
        }

        .hexagon::before,
        .hexagon::after {
            content: "";
            position: absolute;
            border-left: 250px solid transparent;
            border-right: 250px solid transparent;
        }
        .hexagon::before {
            bottom: 100%;
            border-bottom: 144.34px solid #CD5C5C;
        }
        .hexagon::after {
            top: 100%;
            border-top: 144.34px solid #CD5C5C;
        }

        main {
            flex: 1 0 auto;
            margin-left: auto;
            margin-right: auto;
            max-width: 1024px;
        }

        /*.profiletop {*/
        /*    background-color: rgba(0, 0, 0, 0) !important;*/
        /*    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.14), 0 0 0 0 rgba(0, 0, 0, 0.12), 0 0 0 0 rgba(0, 0, 0, 0.2) !important;*/
        /*}*/
        .post-img {
            height: 100% !important;
            width: 200px;

        }


        .card-1 {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
            background: #fff;
            border-radius: 2px;
            display: inline-block;
            height: 200px;
            margin: 1rem;
            position: relative;
            width: 600px;
        }

        .top-card {
            width: 25em;
            margin-top: 3em;
        }

    </style>
</head>
<body>
    <th:block th:replace="fragments/nav-bar :: profile"/>

    <div class="container grey darken-3 top-card">
        <div class="row valign-wrapper">

            <div>
                <div class="offset-s3 m4 offset-m4 hex">
                    <th:block th:each=" photo: ${user.getProfile().getPhotos()}">
                        <img th:if="${photo.getUrl() == null}" class="responsive-img"
                             th:src="${'https://picsum.photos/300?pic=' + #strings.randomAlphanumeric(2)}"
                             alt="placeholder"/>

                        <img class="responsive-img post-img" th:if="${photo.getUrl() != null}"
                             th:src="@{${'/uploads/' + photo.getUrl()}}"/>
                    </th:block>
                </div>
            </div>

        </div>
    </div>
    <div class="container grey darken-3 top-card">
        <div class="row valign-wrapper">
            <div class="card-content center-align col s6 offset-s3">
                    <span class="card-title"><h4 class="headline 700 center"
                                                 th:text=" ${user.getProfile().firstName}"></h4></span>
                <p>I am a very simple card. I am good at containing small bits of information.
                    I am convenient because I require little markup to use effectively.</p>
            </div>


        </div>
    </div>


    <div>
        <h2 class="blue-grey-text text-darken-3 center"> About</h2>
        <div class="divider"></div>
        <div class="section-lg container center z-depth-3 white" id="skills">
            <div class="row section-lg-top">
                <div class="center col s12 m6 l3">
                    <i class="medium icon ion-social-html5 orange-text text-darken-3"></i>
                    <h5>Hobbies</h5>
                    <ul th:each="hobby : ${user.getProfile().getHobbies()}">
                        <li th:text="${hobby.hobby}"></li>
                    </ul>
                </div>
                <div class="center col s12 m6 l3">
                    <i class="medium icon ion-social-css3 light-blue-text"></i>
                    <h5>Personality</h5>
                    <ul th:each="trait : ${user.getProfile().getTraits()}">
                        <li th:text="${trait.trait}"></li>
                    </ul>
                </div>
                <div class="center col s12 m6 l3">
                    <i class="medium icon ion-social-javascript yellow-text"></i>
                    <h5>Current City</h5>
                    <div th:each="location : ${user.getProfile().getLocation()}">
                        <p th:text="${location.location}"></p>
                    </div>
                </div>
                <!--                <div class="center col s12 m6 l3">-->
                <!--                    <i class="medium icon ion-social-nodejs light-green-text"></i>-->
                <!--                    <h5>NODE JS</h5>-->
                <!--                </div>-->
            </div>
        </div>
    </div>

<!--START BUDDIES CONTAINER-->
    <h2 class="blue-grey-text text-darken-3 center">Buddies</h2>
    <div><a id="btn-getInTouch" class="waves-effect waves-light btn"><i class="material-icons left">account_box</i>Message Me</a></div>
    <div class="container">
        <div class="mdl-grid site-max-width">
            <div class="mdl-card__supporting-text">
                <h4 class="headline 700 center">
                    <span> BattleBuddies</span>
                </h4>
            </div>
            <div class="mdl-cell mdl-cell--12-col mdl-card mdl-shadow--4dp welcome-card portfolio-card">
                <div class="mdc-tab-bar" role="tablist">
                    <div class="row">
                        <div class="col s12">
                            <a th:if="${#authentication.principal.id != user.id}" th:href="@{/users/{id}/friend-request(id=${user.id}) }">Send Buddy Request</a>
                            <ul class="tabs">
                                <li  class="tab col s3"><a class="active" href="#test1">Buddies</a></li>
                                <li sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id == user.id}" class="tab col s3"><a href="#test2">Potential Buddies</a></li>
                                <li sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id == user.id}" class="tab col s3"><a href="#test3">Pending Buddies</a></li>
                                <li sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id == user.id}" class="tab col s3"><a href="#test4">Suggested Buddies</a></li>

                            </ul>
                        </div>

<!--                        ACCEPTED BUDDIES-->
                        <div id="test1" class="col s12">
                            <div id="friends" class="col s12  container">
                                <h4> Accepted Buddies List</h4>
                                <th:block th:each="friend : ${user.getRelationships()}" th:if="${friend.getStatus() == T(com.codeup.blog.blog.models.FriendStatus).ACCEPTED}">
                                    <div class="row">
                                        <div class="col s3 ">
                                            <div class="card blue-grey darken-1">
                                                <div class="card-content white-text">
                                                    <a   th:href="@{'/users/profile/' + ${friend.getFriend().id}}"><span class="card-title" th:text="${friend.getFriend().profile.firstName }"></span></a>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </th:block>

                            </div>
                        </div>
                        <div id="test2" class="col s12"  th:if="${#authentication.principal.id == user.id}">

                            <h4>people who want to be <span th:text="${user.username}"></span>'s friend</h4>

                            <div th:each="friend : ${pendingFriends}">

                                <th:block th:each="relationship: ${friend.getRelationships()}" th:if="${relationship.getStatus() == T(com.codeup.blog.blog.models.FriendStatus).PENDING}" >
                                    <div class="row">
                                        <div class="col s3 ">
                                            <div class="card blue-grey darken-1">
                                                <div class="card-content white-text">
                                                    <a   th:href="@{'/users/profile/' + ${friend.id}}"><span class="card-title" th:text="${friend.profile.firstName }"></span></a>
                                                </div>
                                                <a th:if="${relationship.getFriend().username == user.username}" th:href="@{/users/{id}/accept-request(id=${relationship.id}) }">accept</a>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>

                            </div>
                        </div>

                        <div id="test3" class="col s12" th:if="${#authentication.principal.id == user.id}">

                            <div id="pending" class="col s12 ">
                                <th:block sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id == user.id}">
                                    <input type="hidden" th:value="${user.id}">
                                    <h4>friends <span th:text="${user.username}"></span> has requested</h4>
                                    <div th:each="friend : ${user.getRelationships()}" th:if="${friend.getStatus() == T(com.codeup.blog.blog.models.FriendStatus).PENDING}">
                                        <div class="row">
                                            <div class="col s3 ">
                                                <div class="card blue-grey darken-1">
                                                    <div class="card-content white-text">
                                                        <a   th:href="@{'/users/profile/' + ${friend.getFriend().id}}"><span class="card-title" th:text="${friend.getFriend().profile.firstName }"></span></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                        </div>

                        <div id="test4" class="col s12" th:if="${#authentication.principal.id == user.id}">

                            <div  class="col s12">
                                <th:block sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id == user.id}">
                                    <input type="hidden" th:value="${user.id}">
                                    <h4>Suggested buddies for you</h4>
                                    <div th:each="friend : ${suggestedFriends}"  >
                                            <div class="row">
                                                <div class="col s3 ">
                                                    <div class="card blue-grey darken-1">
                                                        <div class="card-content white-text">
                                                            <a   th:href="@{'/users/profile/' + ${friend.id}}"><span class="card-title" th:text="${friend.profile.firstName }"></span></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                    </div>
                                </th:block>
                            </div>
                        </div>
                        <div><a class="waves-effect waves-light btn" th:href="@{'/users/user-details-edit'}"><i class="material-icons left">account_box</i>Edit Profile</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!--END BUDDIES CONTAINER-->


    <!--ADD COMMENT-->
        <div class="container" >
            <form id="add-comment" th:action="@{'/profile/comment/' + ${user.id}}" th:method="post">
                <div class="row">
                    <div class="input-field col s12">
                        <label >Add Comment</label>
                        <div class="right-align">
                            <a href="#" onclick="document.getElementById('add-comment').submit();" class="btn-flat ra teal-text" type="submit">Send</a>
                        </div>
                        <textarea id="comment" th:name="comment" class="materialize-textarea" data-length="2000"></textarea>
                    </div>

                </div>
            </form>
        </div>


    <!--COMMENTS CONTAINER-->
    <div class="container">
        <div th:each="comment : ${comments}">
            <div class="row">
                <div class="col s12">
                    <div class="card ">
                        <div class="card-content ">
                            <a   th:href="@{'/users/profile/' + ${comment.user.id}}"><span class="card-title" th:text="${comment.user.profile.firstName}"></span></a>
                            <p class="text-spacing" th:text="${comment.comment}"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>


<script>
    // Using with jQuery
    $(document).ready(function(){
        $('.datepicker').datepicker();
    });
</script>
<script>

    $(".button-collapse").sideNav();


    function hideLoader() {
        document.getElementById('loaderWrapper').style.display = "none";
    }

    var instance = M.Tabs.getInstance(elem);

    $(document).ready(function () {
        $('.tabs').tabs();
    });

    WebFontConfig = {
        google: {
            families: ['Roboto:300,400,500,700:latin']
        },
        classes: false,
        events: false,
        timeout: 1500
    };
    (function () {
        var wf = document.createElement('script');
        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
        wf.type = 'text/javascript';
        wf.defer = 'true';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wf, s);
    })();
</script>
<script>
    (function(t,a,l,k,j,s){
        s=a.createElement('script');s.async=1;s.src="https://cdn.talkjs.com/talk.js";a.head.appendChild(s)
        ;k=t.Promise;t.Talk={v:2,ready:{then:function(f){if(k)return new k(function(r,e){l.push([f,r,e])});l
                    .push([f])},catch:function(){return k&&new k()},c:l}};})(window,document,[]);
</script>

<!-- TalkJS initialization code, which we'll customize in the next steps -->
<script>


    var currentUser;
    var otherUser;
    var pathVariable =location.pathname.split("/")[3];

    fetch("/users/chat/" + pathVariable)
        .then(response => response.json())
        .then(data => {
            currentUser = data[0];
            otherUser = data[1];
            logDataset();
        });

    function logDataset () {
        console.log(currentUser.email);

        Talk.ready.then(function() {

            var me = new Talk.User({
                id: currentUser.id,
                name: currentUser.profile.firstName,
                email: currentUser.email,

            });
            window.talkSession = new Talk.Session({
                appId: "toAwBOgu",
                me: me
            });




            var other = new Talk.User({
                id: otherUser.id,
                name: otherUser.profile.firstName,
                email: otherUser.email,
            });



            var conversation = talkSession.getOrCreateConversation(Talk.oneOnOneId(me, other));
            conversation.setParticipant(me);
            conversation.setParticipant(other);
            var popup = talkSession.createPopup(conversation, { keepOpen: false });
            popup.mount({ show: false });

            var button = document.getElementById("btn-getInTouch");
            button.addEventListener("click", function(event) {
                event.preventDefault();
                popup.show();
            });

        });
    }
</script>

</html>

